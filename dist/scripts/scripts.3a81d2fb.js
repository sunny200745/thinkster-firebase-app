"use strict";var app=angular.module("angNewsApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","firebase"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/posts.html",controller:"PostsCtrl"}).when("/posts/:postId",{templateUrl:"views/showpost.html",controller:"PostViewCtrl"}).when("/register",{templateUrl:"views/register.html",controller:"AuthCtrl",resolve:{user:["auth",function(a){return a.resolveUser()}]}}).when("/login",{templateUrl:"views/login.html",controller:"AuthCtrl",resolve:{user:["auth",function(a){return a.resolveUser()}]}}).when("/users/:userId",{templateUrl:"views/profile.html",controller:"ProfileCtrl"}).otherwise({redirectTo:"/"})}]).constant("FIREBASE_URL","https://sweltering-fire-6232.firebaseio.com/");angular.module("angNewsApp").controller("PageCtrl",["$scope",function(a){a.moduleName="Page",console.debug("I am PAGE CONTROLLER !! EVERY ONE PARENT :)")}]),angular.module("angNewsApp").controller("PostsCtrl",["$scope","post","$location","auth",function(a,b,c,d){a.moduleName="Posts",a.posts=b.all,a.user=d.user,console.debug(a.posts),a.post={url:"http://",title:""},a.deletePost=function(a){b["delete"](a)}}]),angular.module("angNewsApp").factory("post",["$firebase","FIREBASE_URL",function(a,b){var c=new Firebase(b),d=a(c.child("posts")).$asArray(),e={all:d,create:function(b){return d.$add(b).then(function(d){return a(c.child("user_posts").child(b.creatorUID)).$push(d.name()),d})},get:function(b){return a(c.child("posts").child(b)).$asObject()},"delete":function(a){return d.$remove(a)},comments:function(b){return a(c.child("comments").child(b)).$asArray()}};return e}]),angular.module("angNewsApp").controller("PostViewCtrl",["$scope","$routeParams","post","auth",function(a,b,c,d){a.moduleName="PostView",console.debug(a.moduleName),a.post=c.get(b.postId),a.comments=c.comments(b.postId),a.user=d.user,a.signedIn=d.signedIn,a.addComment=function(){if(a.commentText&&""!==a.commentText){var b={text:a.commentText,creator:a.user.profile.username,creatorUID:a.user.uid};a.comments.$add(b),a.commentText=""}},a.deleteComment=function(b){a.comments.$remove(b)}}]),angular.module("angNewsApp").controller("NavCtrl",["$scope","post","$location","auth",function(a,b,c,d){a.moduleName="Nav",a.signedIn=d.signedIn,a.logout=d.logout,a.post={url:"http://",title:""},a.user=d.user,a.submitPost=function(){a.post.creator=a.user.profile.username,a.post.creatorUID=a.user.uid,b.create(a.post).then(function(b){c.path("/posts/"+b.name()),a.post={url:"http://",title:""}})}}]),angular.module("angNewsApp").filter("hostnameFromUrl",function(){return function(a){var b=document.createElement("a");return b.href=a,b.hostname}}),angular.module("angNewsApp").factory("auth",["$firebaseSimpleLogin","FIREBASE_URL","$rootScope","$firebase",function(a,b,c,d){var e=new Firebase(b),f=a(e),g={register:function(a){return f.$createUser(a.email,a.password)},createProfile:function(a){var b={username:a.username,md5_hash:a.md5_hash},c=d(e.child("profile"));return c.$set(a.uid,b)},login:function(a){return console.debug(a),f.$login("password",a)},logout:function(){f.$logout()},resolveUser:function(){return f.$getCurrentUser()},signedIn:function(){return!!g.user.provider},user:{}};return c.$on("$firebaseSimpleLogin:login",function(a,b){console.debug("logged IN"),angular.copy(b,g.user),g.user.profile=d(e.child("profile").child(g.user.uid)).$asObject()}),c.$on("$firebaseSimpleLogin:logout",function(){console.debug("logged OUT"),g.user&&g.user.profile&&g.user.profile.$destroy(),angular.copy({},g.user)}),g}]),angular.module("angNewsApp").controller("AuthCtrl",["$scope","user","auth","$location",function(a,b,c,d){a.moduleName="Auth",b&&d.path("/"),a.login=function(){c.login(a.user).then(function(){d.path("/")},function(b){a.error=b.toString()})},a.register=function(){c.register(a.user).then(function(b){return c.login(a.user).then(function(){return b.username=a.user.username,c.createProfile(b)}).then(function(){d.path("/")})},function(b){a.error=b.toString()})}}]),angular.module("angNewsApp").controller("ProfileCtrl",["$scope","Profile","$routeParams",function(a,b,c){a.moduleName="Profile";var d=c.userId;a.profile=b.get(d),b.getPosts(d).then(function(b){a.posts=b})}]),angular.module("angNewsApp").factory("Profile",["$window","FIREBASE_URL","$firebase","post","$q",function(a,b,c,d,e){var f=new a.Firebase(b),g={get:function(a){return c(f.child("profile").child(a)).$asObject()},getPosts:function(a){var b=e.defer();return c(f.child("user_posts").child(a)).$asArray().$loaded().then(function(a){for(var c={},e=0;e<a.length;e++){var f=a[e].$value;c[f]=d.get(f)}b.resolve(c)}),b.promise}};return g}]);